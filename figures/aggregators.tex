% Copyright 2025 University of Twente
%
% Licensed under the Apache License, Version 2.0 (the "License");
% you may not use this file except in compliance with the License.
% You may obtain a copy of the License at
%
%     http://www.apache.org/licenses/LICENSE-2.0
%
% Unless required by applicable law or agreed to in writing, software
% distributed under the License is distributed on an "AS IS" BASIS,
% WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
% See the License for the specific language governing permissions and
% limitations under the License.

\input{cpesdiag/cpesdiag.tex}
\cpesstyle

% use the following style instead to have the diagram in grayscale
% \cpesstylegrey

% use the following style instead to have the diagram in light grey colours
% \cpesstylelight

% use the following command to have a dashed line
% \CPESdashed
% and restore using
% \CPESsolid

% These commands can be used in the figure to switch between styles

\begin{tikzpicture} 
% PHY:
% mds:grid_on
% mds:join
% mds:electric_meter
% mds:electric_meter
%
%
% DEV
% mds:battery_android_4
% mds:solar_power
% mds:local_laundry_service
% mds:ev_charger
% mds:electric_car
%
%
% CYBER
% mds:memory
% mds:network_intelligence
%
% mds:house
% mds:communities
%
%
% INTERACT
% mds:person
% mds:groups
% mds:euro
% mds:gavel
% mds:domain
% mds:things_to_do


% Physical nodes
\phynodex{grid}{0,0}{mds:grid_on}{label={above:\tiny{power grid}}};
\phynodex{meter1}{1,-1}{mds:electric_meter}{label={above:\tiny{smart meter}}};
\phynodex{meter2}{1,-3}{mds:electric_meter}{label={}};

\pnodex{j}{0,-1}{};


% Device nodes
\devicenodex{d1}{3,0}{mds:battery_android_4}{label={}};
\devicenodex{d2}{3,-1}{mds:solar_power}{label={}};
\devicenodex{d3}{3,-2}{mds:local_laundry_service}{label={}};
\devicenodex{d4}{3,-3}{mds:electric_car}{label={}};


\dnodex{dn1}{2,-1}{};
\dnodex{dn2}{2,-3}{};




% Control nodes
\controlnodedx{agg1}{6,-0.5}{mds:network_intelligence}{mds:house}{label={}};
\controlnodedx{agg2}{6,-2.5}{mds:network_intelligence}{mds:house}{label={}};


\cnodex{c1}{4,-0.5}{};
\cnodex{c2}{5,-2.5}{};

% Interaction nodes
\interactnodex{m1}{7.5,-0.5}{mds:domain}{label={}};
\interactnodex{m2}{7.5,-2.5}{mds:person}{label={}};


%
% % Physical links
\draw [plink] (grid.south) -- (j.north);
\draw [plink] (j.east) -- (meter1.west);
\draw [plink] (j.south) |- (meter2.west);
%
%
% % Device links
\draw [<->, dlink] (meter1.east) -- (dn1.west);
\draw [<->, dlink] (dn1.north) |- (d1.west);
\draw [<-, dlink] (dn1.east) -- (d2.west);
%
\draw [->, dlink] (meter2.east) -- (dn2.west);
\draw [<->, dlink] (dn2.north) |- (d3.west);
\draw [<-, dlink] (dn2.east) -- (d4.west);
%
%
% % Control links
\draw [clink] (agg1.west) -- (c1.east);
\draw [->, clink] (c1.north) |- (d1.east);
\draw [->, clink] (c1.south) |- (d3.east);

\draw [clink] (agg2.west) -- (c2.east);
\draw [->, clink] (c2.north) |- (d2.east);
\draw [->, clink] (c2.south) |- (d4.east);

%
% % Interaction links
\draw [->, ilinku] (m1.west) -- (agg1.east);
\draw [->, ilinku] (m2.west) -- (agg2.east);

\end{tikzpicture}
