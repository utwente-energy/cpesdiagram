% Copyright 2025 University of Twente
%
% Licensed under the Apache License, Version 2.0 (the "License");
% you may not use this file except in compliance with the License.
% You may obtain a copy of the License at
%
%     http://www.apache.org/licenses/LICENSE-2.0
%
% Unless requi\CPESColourInteraction by applicable law or agreed to in writing, software
% distributed under the License is distributed on an "AS IS" BASIS,
% WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
% See the License for the specific language governing permissions and
% limitations under the License.

% Commands
% Initializing the different settings for CPES Diagrams
% Please modify the functions below if you wish to change the colours
\newcommand\CPESColourPhy{black}
\newcommand\CPESColourDevice{blue}
\newcommand\CPESColourControl{teal}
\newcommand\CPESColourInteraction{red}

\newcommand\CPESColourText{black}

\newcommand\CPESTransparency{1.0}
\newcommand\CPESTransparencySmall{0.6}

\newcommand\CPESOutline{solid}
\newcommand\CPESBilink{solid}
\newcommand\CPESUnilink{densely dotted}

% Functions to switch between colour schemes
% Default colours
\def \CPESDefaultColours{
  \renewcommand\CPESColourPhy{black}
  \renewcommand\CPESColourDevice{blue}
  \renewcommand\CPESColourControl{teal}
  \renewcommand\CPESColourInteraction{red}
  \renewcommand\CPESColourText{black}
}


% Greyscale colours
\def \CPESGreyColours{
  \renewcommand\CPESColourPhy{black}
  \renewcommand\CPESColourDevice{black}
  \renewcommand\CPESColourControl{gray}
  \renewcommand\CPESColourInteraction{gray}
  \renewcommand\CPESColourText{black}
}


% Light colours
\def \CPESLightColours{
  \renewcommand\CPESColourPhy{lightgray}
  \renewcommand\CPESColourDevice{lightgray}
  \renewcommand\CPESColourControl{lightgray}
  \renewcommand\CPESColourInteraction{lightgray}
  \renewcommand\CPESColourText{lightgray}
}



% Default transpancy
\def \CPESDefaultTransparency{
  \renewcommand\CPESTransparency{1.0}
  \renewcommand\CPESTransparencySmall{0.6}
}

% Light transparency theme
\def \CPESLightTransparency{
  \renewcommand\CPESTransparency{0.4}
  \renewcommand\CPESTransparencySmall{0.3}
}


% Macros to switch between actual devices and virtual elements
\def \CPESsolid{
  \renewcommand\CPESOutline{solid}
  \renewcommand\CPESBilink{solid}
  \renewcommand\CPESUnilink{densely dotted}
}

\def \CPESdashed{
  \renewcommand\CPESOutline{dashed}
  \renewcommand\CPESBilink{dashed}
  \renewcommand\CPESUnilink{loosely dashdotted}
}


% CPES Tikz definitions
\def \importcpesnodestyle{
\tikzset{
% Normal node styles
  % Devices
  device/.style={rectangle, \CPESOutline, draw=\CPESColourDevice, rounded corners=2pt, inner sep=11pt, top color=white, bottom color=\CPESColourDevice!25, text=\CPESColourText},
  % Physical
  phy/.style={circle, \CPESOutline, draw=\CPESColourPhy, inner sep=8pt, top color=white, bottom color=\CPESColourPhy!25, text=\CPESColourText},
  % Cyber controllers
  control/.style={regular polygon, regular polygon sides=6, \CPESOutline, draw=\CPESColourControl, rounded corners=1pt, inner sep=8pt, top color=white, bottom color=\CPESColourControl!25, text=\CPESColourText},
  % Societal interaction
  interact/.style={diamond, \CPESOutline, draw=\CPESColourInteraction, rounded corners=2pt, inner sep=8pt,  top color=white, bottom color=\CPESColourInteraction!25, text=\CPESColourText},
  %
  % Node connector style (small icons to connect lines)
  % Devices
  dnode/.style={rectangle, \CPESOutline, fill=\CPESColourDevice, draw=\CPESColourDevice, inner sep=3pt, text=\CPESColourText},
  % Physical flow
  pnode/.style={circle, \CPESOutline, fill=\CPESColourPhy, draw=\CPESColourPhy, inner sep=2pt, text=\CPESColourText},
  % Cyber controllers
  cnode/.style={regular polygon, regular polygon sides=6, \CPESOutline, fill=\CPESColourControl, draw=\CPESColourControl, inner sep=2pt, text=\CPESColourText},
  % Societal interaction
  inode/.style={diamond, \CPESOutline, fill=\CPESColourInteraction, draw=\CPESColourInteraction, inner sep=1.5pt, text=\CPESColourText},
  % Global settings
  every label/.style={\CPESColourText}
  }
}

\def \importcpeslinestyle{
\tikzset{
% Style for links between nodes
  % Devices
  dlink/.style={\CPESColourDevice, \CPESBilink, rounded corners=5pt, text=\CPESColourText},
  % Physical
  plink/.style={\CPESColourPhy, \CPESBilink, thick, rounded corners=5pt, text=\CPESColourText},
  % Cyber controllers
  clink/.style={\CPESColourControl, \CPESBilink, thick, rounded corners=5pt, text=\CPESColourText},
  % Cyber controllers (uni-directional)
  clinku/.style={\CPESColourControl, \CPESUnilink, thick, rounded corners=5pt, text=\CPESColourText},
  % Societal interaction
  ilink/.style={\CPESColourInteraction, \CPESBilink, rounded corners=5pt, text=\CPESColourText},
  % Societal interaction (uni-directional)
  ilinku/.style={\CPESColourInteraction, \CPESUnilink, rounded corners=5pt, text=\CPESColourText}
  }
}


% Import command for the coloured style
\def \cpesstyle{
  \importcpesnodestyle
  \importcpeslinestyle

%   % Styles
  \CPESDefaultColours
  \CPESDefaultTransparency
}


% Import command to use the greyscale version
\def \cpesstylegrey{
  \importcpesnodestyle
  \importcpeslinestyle

  % Styles
  \CPESGreyColours
  \CPESDefaultTransparency
}


% Import command to use the grayscale version instead if you prefer to use American English ;-)
\def \cpesstylegray{
  \cpesstylegrey
}


% Import command to use the light version
\def \cpesstylelight{
  \importcpesnodestyle
  \importcpeslinestyle

  % Styles
  \CPESLightColours
  \CPESLightTransparency
}





% Node definitions for placing in a matrix or relative placement


% The large nodes
% parameters:
%   #1: unique name for identification
%   #2: Optional position of the node (e.g., relative)
%   #3: icon name (as provided by the material design icons, see https://fonts.google.com/icons)
%   #4: label text with styling (e.g., label=right:\scriptsize{some device})
% for respectively device, physcial, controllers (cyber), and societal interaction
\def \devicenode#1#2#3#4{
  \node (#1) [device, #2, #4] {\pgfbox[center,center]{\transparent{\CPESTransparency}\includegraphics[scale=0.5]{cpesdiag/icons/pdf/plain/#3.pdf}}}
}

\def \phynode#1#2#3#4{
  \node (#1) [phy, #2, #4] {\pgfbox[center,center]{\transparent{\CPESTransparency}\includegraphics[scale=0.5]{cpesdiag/icons/pdf/plain/#3.pdf}}}
}

\def \controlnode#1#2#3#4{
  \node (#1) [control, #2, #4] {\pgfbox[center,center]{\transparent{\CPESTransparency}\includegraphics[scale=0.5]{cpesdiag/icons/pdf/plain/#3.pdf}}}
}

\def \interactionnode#1#2#3#4{
  \node (#1) [interact, #2, #4] {\pgfbox[center,center]{\transparent{\CPESTransparency}\includegraphics[scale=0.5]{cpesdiag/icons/pdf/plain/#3.pdf}}}
}


% The large nodes with dual icons
% parameters:
%   #1: unique name for identification
%   #2: Optional position of the node (e.g., relative)
%   #3: large icon name (right, transparent) (as provided by the material design icons, see https://fonts.google.com/icons)
%   #4: small icon name (left bottom, filled version) (as provided by the material design icons, see https://fonts.google.com/icons)
%   #5: label text with styling (e.g., label=right:\scriptsize{some device})
% for respectively device, physcial, controllers (cyber), and societal interaction
\def \devicenoded#1#2#3#4#5{
  \node (#1) [device, #2, #5] {};
  \pgfputat{\pgfxy(0,0)}{\pgfbox[center,center]{\transparent{\CPESTransparencySmall}\includegraphics[scale=0.4, trim=0pt -10pt -10pt 0pt]{cpesdiag/icons/pdf/plain/#3.pdf}}};
  \pgfputat{\pgfxy(0,0)}{\pgfbox[center,center]{\transparent{\CPESTransparency}\includegraphics[scale=0.25, trim=-28pt 0pt 0pt -28pt]{cpesdiag/icons/pdf/fill/#4.pdf}}}
}

\def \phynoded#1#2#3#4#5{
  \node (#1) [phy, #2, #5] {};
  \pgfputat{\pgfxy(0,0)}{\pgfbox[center,center]{\transparent{\CPESTransparencySmall}\includegraphics[scale=0.4, trim=0pt -10pt -10pt 0pt]{cpesdiag/icons/pdf/plain/#3.pdf}}};
  \pgfputat{\pgfxy(0,0)}{\pgfbox[center,center]{\transparent{\CPESTransparency}\includegraphics[scale=0.25, trim=-28pt 0pt 0pt -28pt]{cpesdiag/icons/pdf/fill/#4.pdf}}}
}

\def \controlnoded#1#2#3#4#5{
  \node (#1) [control, #2, #5] {};
  \pgfputat{\pgfxy(0,0)}{\pgfbox[center,center]{\transparent{\CPESTransparencySmall}\includegraphics[scale=0.4, trim=0pt -10pt -10pt 0pt]{cpesdiag/icons/pdf/plain/#3.pdf}}};
  \pgfputat{\pgfxy(0,0)}{\pgfbox[center,center]{\transparent{\CPESTransparency}\includegraphics[scale=0.25, trim=-28pt 0pt 0pt -28pt]{cpesdiag/icons/pdf/fill/#4.pdf}}}
}

\def \interactionnoded#1#2#3#4#5{
  \node (#1) [interact, #2, #5] {};
  \pgfputat{\pgfxy(0,0)}{\pgfbox[center,center]{\transparent{\CPESTransparencySmall}\includegraphics[scale=0.4, trim=0pt -10pt -10pt 0pt]{cpesdiag/icons/pdf/plain/#3.pdf}}};
  \pgfputat{\pgfxy(0,0)}{\pgfbox[center,center]{\transparent{\CPESTransparency}\includegraphics[scale=0.25, trim=-28pt 0pt 0pt -28pt]{cpesdiag/icons/pdf/fill/#4.pdf}}}
}



% The small connection nodes
% parameters:
%   #1: unique name for identification
%   #2: label text with styling (e.g., label=right:\scriptsize{some device})
% for respectively device, physcial, controllers (cyber), and societal interaction
\def \dnode#1#2{
  \node (#1) [dnode, #2] {}
}

\def \pnode#1#2{
  \node (#1) [pnode, #2] {}
}

\def \cnode#1#2{
  \node (#1) [cnode, #2] {}
}

\def \inode#1#2{
  \node (#1) [inode, #2] {}
}




% Node definitions using coordinate system

% The large nodes
% parameters:
%   #1: unique name for identification
%   #2: coordinates (e.g., (1,1))
%   #3: icon name (as provided by the material design icons, see https://fonts.google.com/icons)
%   #4: label text with styling (e.g., label=right:\scriptsize{some device})
% for respectively device, physcial, controllers (cyber), and societal interaction
\def \devicenodex#1#2#3#4{
  \node (#1) at (#2) [device, #4] {\pgfbox[center,center]{\transparent{\CPESTransparency}\includegraphics[scale=0.5]{cpesdiag/icons/pdf/plain/#3.pdf}}}
}

\def \phynodex#1#2#3#4{
  \node (#1) at (#2) [phy, #4] {\pgfbox[center,center]{\transparent{\CPESTransparency}\includegraphics[scale=0.5]{cpesdiag/icons/pdf/plain/#3.pdf}}}
}

\def \controlnodex#1#2#3#4{
  \node (#1) at (#2) [control, #4] {\pgfbox[center,center]{\transparent{\CPESTransparency}\includegraphics[scale=0.5]{cpesdiag/icons/pdf/plain/#3.pdf}}}
}

\def \interactnodex#1#2#3#4{
  \node (#1) at (#2) [interact, #4] {\pgfbox[center,center]{\transparent{\CPESTransparency}\includegraphics[scale=0.5]{cpesdiag/icons/pdf/plain/#3.pdf}}}
}


% The large node swith dual icons
% parameters:
%   #1: unique name for identification
%   #2: coordinates (e.g., (1,1))
%   #3: large icon name (right, transparent) (as provided by the material design icons, see https://fonts.google.com/icons)
%   #4: small icon name (left bottom, filled version) (as provided by the material design icons, see https://fonts.google.com/icons)
%   #5: label text with styling (e.g., label=right:\scriptsize{some device})
% for respectively device, physcial, controllers (cyber), and societal interaction
\def \devicenodedx#1#2#3#4#5{
  \node (#1) at (#2) [device, #5] {};
  \pgfputat{\pgfxy(#2)}{\pgfbox[center,center]{\transparent{\CPESTransparencySmall}\includegraphics[scale=0.4, trim=0pt -10pt -10pt 0pt]{cpesdiag/icons/pdf/plain/#3.pdf}}};
  \pgfputat{\pgfxy(#2)}{\pgfbox[center,center]{\transparent{\CPESTransparency}\includegraphics[scale=0.25, trim=-28pt 0pt 0pt -28pt]{cpesdiag/icons/pdf/fill/#4.pdf}}}
}

\def \phynodedx#1#2#3#4#5{
  \node (#1) at (#2) [phy, #5] {};
  \pgfputat{\pgfxy(#2)}{\pgfbox[center,center]{\transparent{\CPESTransparencySmall}\includegraphics[scale=0.4, trim=0pt -10pt -10pt 0pt]{cpesdiag/icons/pdf/plain/#3.pdf}}};
  \pgfputat{\pgfxy(#2)}{\pgfbox[center,center]{\transparent{\CPESTransparency}\includegraphics[scale=0.25, trim=-28pt 0pt 0pt -28pt]{cpesdiag/icons/pdf/fill/#4.pdf}}}
}

\def \controlnodedx#1#2#3#4#5{
  \node (#1) at (#2) [control, #5] {};
  \pgfputat{\pgfxy(#2)}{\pgfbox[center,center]{\transparent{\CPESTransparencySmall}\includegraphics[scale=0.4, trim=0pt -10pt -10pt 0pt]{cpesdiag/icons/pdf/plain/#3.pdf}}};
  \pgfputat{\pgfxy(#2)}{\pgfbox[center,center]{\transparent{\CPESTransparency}\includegraphics[scale=0.25, trim=-28pt 0pt 0pt -28pt]{cpesdiag/icons/pdf/fill/#4.pdf}}}
}

\def \interactnodedx#1#2#3#4#5{
  \node (#1) at (#2) [interact, #5] {};
  \pgfputat{\pgfxy(#2)}{\pgfbox[center,center]{\transparent{\CPESTransparencySmall}\includegraphics[scale=0.4, trim=0pt -10pt -10pt 0pt]{cpesdiag/icons/pdf/plain/#3.pdf}}};
  \pgfputat{\pgfxy(#2)}{\pgfbox[center,center]{\transparent{\CPESTransparency}\includegraphics[scale=0.25, trim=-28pt 0pt 0pt -28pt]{cpesdiag/icons/pdf/fill/#4.pdf}}}
}

% The small connection nodes
%   #1: unique name for identification
%   #2: coordinates (e.g., (1,1))
%   #3: label text with styling (e.g., label=right:\scriptsize{some device})
% for respectively device, flow (physcial), controllers (cyber), and societal interaction
\def \dnodex#1#2#3{
  \node (#1) at (#2) [dnode, #3] {}
}

\def \pnodex#1#2#3{
  \node (#1) at (#2) [pnode, #3] {}
}

\def \cnodex#1#2#3{
  \node (#1) at (#2) [cnode, #3] {}
}

\def \inodex#1#2#3{
  \node (#1) at (#2) [inode, #3] {}
}
